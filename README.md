# Exam.me
Проект для дисциплин “Введение в системы баз данных” и “Технологии Интернет и WEB-программирования”.
Проект является групповым, участники: *Борисова Елена* и *Радькова Ирина* (20.Б12-пу).

Для запуска проекта необходимо:
- установить зависимости проектов ui и server с помощью команды  ```npm install```
- развернуть базу данных mysql и обновить данные (имя, пароль) в файле ./server/.env
- скомпилировать приложение ui ```ng build``` и перенести папку dist в корень проекта
- запустить приложение ```cd ./server/``` ```node app.js```

По умолчанию приложение будет запущено на порте 3000
# Описание
Онлайн-блокнот для совместного написания конспектов, нацеленный на подготовку к экзаменам. В конечном итоге они могут представлять собой краткое изложение всего курса и использоваться для закрепления изученного материала при подготовке к экзаменам.
## Наименование
Exam.me
## Предметная область
Онлайн-конспекты, составленные по примерным спискам экзаменационных вопросов (статья является ответом на один из вопросов списка). 
# Навигация
- Данные
  - [Ограничения](#для-каждого-элемента-данных---ограничения)
  - [Общие ограничения целостности](#общие-ограничения-целостности)
  - [Пользовательские роли](#пользовательские-роли)
- Описание основных функций
  - [Создание и управление академической группой](#1-создание-и-управление-академической-группой)
  - [Присоединение к академической группе](#2-присоединение-к-академической-группе)
  - [Управление списком вопросов](#3-управление-списком-вопросов)
  - [Добавление нового ответа в список вопросов](#4-добавление-нового-ответа-в-список-вопросов)
  - [Редактирование ответа](#5-редактирование-ответа)
  - [Восстановление версии ответа](#6-восстановление-версии-ответа)
  - [Удаление ответа из списка](#7-удаление-ответа-из-списка)
  - [Публикация списка](#8-публикация-списка)
  - [Передача полномочий старосты](#9-передача-полномочий-старосты)
  - [Исключение участника из группы](#10-исключение-участника-из-группы)
- [Техническая часть](#техническая-часть)
# Данные
![image](https://user-images.githubusercontent.com/63803498/209424588-90b159ad-ffcd-45b9-a1ed-dba0a49556eb.png)
- users - информация о пользователях
- academgroups - информация об академических группах
- faculty - информация о факультете
- program - информация об образовательной программе
- lists - список экзаменационных вопросов
- subjects - информация о предметах
- question - актуальная статья-ответ на один из вопросов списка
- versioned - хранилище всех версий статьи-ответа
## Для каждого элемента данных - ограничения
### users
- `vk_id` должен быть уникальным
- `group_id` по умолчанию null
- `status` по умолчанию null (для новых пользователей; при первой авторизации это нужно для редиректа в профиль, чтобы пользователь мог сверить полученные из Вконтакте данные и внести правки)
- `user_pname` по умолчанию null
### academgroups
- `group_admin` должен быть уникальным
- `access_token` по умолчанию null (что соответствует тому, что староста ещё ни разу не запрашивал ссылку-приглашение)
### lists
- `is_public` может принимать значение 0 или 1
    - 0 (по умолчанию) - список доступен только группе-владельцу
    - 1 - список доступен для просмотра всем посетителям сайта
### question
- `question_body` по умолчанию null
- `is_deleted` может принимать значение 0 или 1
  - 0 (по умолчанию) - вопрос виден, доступен к редактированию, комментированию
  - 1 - вопрос недоступен к просмотру, редактированию, комментированию

[Оглавление](#навигация)
## Общие ограничения целостности
- К одному факультету и образовательной программе могут относиться нуль (если не была создана ни одна группа) или несколько групп
- К одной академической группе относится хотя бы один пользователь (и по умолчанию этот пользователь считается старостой, администратором группы)
- Один пользователь может состоять в не более чем одной группе 
  - Допускается отсутствие группы у пользователя; тогда он может просматривать только публичные списки вопросов
- Академическая группа может иметь нуль и более списков вопросов
- К одному предмету могут относиться нуль или несколько списков вопросов
- Каждая версия ответа на вопрос сохраняется в таблице versioned; самый последний ответ является актуальным и принадлежит таблице question (т.е. актуальная версия ответа на вопрос содержится в обеих таблицах)

[Оглавление](#навигация)
## Пользовательские роли
- Староста академической группы (Group Admin):
    - Управлять академической группой (см. ["Создание и управление академической группой"](#1-создание-и-управление-академической-группой))
    - Управлять списками вопросов, которыми владеет группа (см. ["Управление списком вопросов"](#3-управление-списком-вопросов))
    - Сделать список вопросов общедоступным (см. ["Публикация списка"](#8-публикация-списка))
    - Восстанавливать версию ответа в случае порчи актуальной версии (см. ["Восстановление версии ответа"](#6-восстановление-версии-ответа))
    - Передавать свои полномочия другим участникам группы (см. ["Передача полномочий старосты"](#9-передача-полномочий-старосты))
    - Удалять пользователей из студенческой группы (см. ["Исключение участника из группы"](#10-исключение-участника-из-группы))
- Пользователь (User)
    - Создать новую академическую группу (см. ["Создание и управление академической группой"](#1-создание-и-управление-академической-группой))
    - Присоединиться к существующей академической группе (см. ["Присоединение к академической группе"](#2-присоединение-к-академической-группе))
    - Редактировать ответ (см. ["Редактирование ответа"](#5-редактирование-ответа))
    - Добавлять ответ в список вопросов (см. ["Добавление нового ответа в список вопросов"](#4-добавление-нового-ответа-в-список-вопросов))
- Неавторизированный пользователь
    - Просмотр общедоступных списков вопросов

[Оглавление](#навигация)
# Описание основных функций
### 1. Создание и управление академической группой
Любой пользователь может создать академическую группу, в которой по умолчанию будет иметь роль старосты. При создании пользователь указывает:
- Название группы (которое не обязательно является уникальным)
- К какому факультету относится группа (впоследствии не может быть изменено)
- К какой образовательной программе относится группа (впоследствии не может быть изменено)
- Номер курса

Управление академической группой предполагает:
- Контроль состава участников группы (в случае обнаружения старостой посторонних лиц, он имеет право исключить их из группы; см. ["Исключение участника из группы"](#10-исключение-участника-из-группы))
- Контроль актуальной информации о номере курса
- Создание и управление списками экзаменационных вопросов (см. ["Управление cписком вопросов"](#3-управление-списком-вопросов))

[Оглавление](#навигация)
### 2. Присоединение к академической группе
Любой пользователь может присоединиться к академической группе, перейдя по ссылке-приглашению. Срок действия ссылки ограничен, поэтому староста может сгенерировать новую ссылку по истечении некоторого промежутка времени.

[Оглавление](#навигация)
### 3. Управление списком вопросов
Только староста академической группы может создавать списки экзаменационных вопросов и в дальнейшем управлять ими.

При создании списка староста обязан указать:
- Предмет, к которому относится список
- Название списка
- Будет ли доступен создаваемый список всем посетителям сайта к просмотру

Доступность списка - параметр, который может быть изменён впоследствии.

Управление списком вопросов - контроль за качеством наполнения списка. Староста должен следить за тем, чтобы содержание добавляемых ответов соответствовало сути вопросов. В случае, если будет обнаружено несоответсвие (порча ответа), староста имеет право:
- Выбрать альтернативную версию ответа, если таковая существует (см. ["Восстановление версии ответа"](#6-восстановление-версии-ответа))
- Полностью удалить ответ из списка (см. ["Удаление ответа из списка"](#7-удаление-ответа-из-списка))

[Оглавление](#навигация)
### 4. Добавление нового ответа в список вопросов
Любой участник группы-владельца списка может добавить в него ответ на вопрос. При этом участник должен:
- Написать формулировку вопроса
- Написать ответ на вопрос
- Задать порядок вопроса в списке (рекомендуется располагать вопросы в той же последовательности, в какой они даны в фактическом списке экзаменационных вопросов)

При попытке создать дубликат вопроса (т.е. когда два вопроса имеют один порядок или одинаковое название), система сообщает пользователю, что такой вопрос уже есть, и просит его редактировать то, что имеется. 

[Оглавление](#навигация)
### 5. Редактирование ответа
Любой участник группы может отредактировать ответ на вопрос.  
Редактирование ответа на вопрос предоставляет следующие возможности:
- Изменение порядка вопроса
- Изменение формулировки вопроса
- Изменение ответа на вопрос

[Оглавление](#навигация)
### 6. Восстановление версии ответа
Данной возможностью обладает только староста группы и только тогда, когда ответ находится в одном из списков, созданном этой группой. Староста может просмотреть все версии данного ответа на вопрос. Ему доступны:
- Дата сохранения просматриваемой версии
- Автор просматриваемой версии
- Прочее содержание версии

[Оглавление](#навигация)
### 7. Удаление ответа из списка
Может произойти так, что один или несколько вопросов не появятся на экзамене. Или в список был добавлен вопрос, который не относится к этому экзамену. В таком случае он может быть удалён из списка только старостой группы. При удалении порядок остальных вопросов не изменяется. Вместе с актуальной версией вопроса все предыдущие версии становятся недоступными к просмотру даже старосте.

[Оглавление](#навигация)
### 8. Публикация списка
Староста-владелец списка может сделать его доступным всем посетителям сайта. В таком случае данный список станосится доступен к просмотру всем посетителям сайта.

[Оглавление](#навигация)
### 9. Передача полномочий старосты
Действующий староста академической группы может передать свою роль только одному члену группы и на постоянной основе.

[Оглавление](#навигация)
### 10. Исключение участника из группы
Староста обладает возможностью исключения участника из группы. В таком случае исключённый участник более не относится к этой группе и имеет возможность просматривать только общедоступные списки вопросов.

[Оглавление](#навигация)
# Техническая часть
## UI/API
### UI
Для запуска ui приложения в папке ui нужно прописать `npm install`, а затем `ng s` (при условии установленного Angular. Иначе нужно прописать еще npm install -g @angular/cli).

Также для реализации ui помимо встроенных методов Angular использовалась библиотек `Taiga UI`.
### API пользователя
- GET `api/profile/` - получение профиля пользователя: фамилия, имя, отчество, группа (при наличии)
- PUT `api/profile/edit` - редактирование данных пользователя (фамилия, имя, отчество)
### API группы
- GET `api/group/:groupid` - получение информации о группе
- POST `api/group/create` - создание новой группы
- PUT `api/group/:groupid/edit` - редактирование группы
- GET `api/group/:groupid/invite` - создание ссылки-приглашения в группу
- POST `api/group/join/:token` - присоединение к группе по приглашению-ссылке
- PUT `api/group/:groupid/expel` - исключение участника из группы
### API списка
#### Публичные списки
- GET `api/lists/public/subject/:subjectid` - получение публичных списков по выбранному предмету
- GET `api/lists/public/:listid` - получение информации о конкретном публичном списке
- GET `api/lists/public/:listid/all`- получение всех вопросов конкретного публичного списка
#### Приватные списки
- GET `api/lists/:listid` - получение информации о конкретном приватном списке
- POST `api/lists/:groupid/create-list` - создание группой нового списка вопросов
- PUT `api/lists/:groupid/:listid/publish` - публикация приватного списка
### API вопросов
- GET `api/lists/:listid/all` - получение всех вопросов конкретного приватного списка
- GET `api/lists/:listid/:questionid` - получение заданного вопроса из конкретного приватного списка
- GET `api/lists/:listid/:questionid/versions` - получение списка версий для заданного вопроса
- PUT `api/lists/:listid/:questionid/:versionid` - восстановление версии вопроса
- POST `api/lists/:listid/create` - создание нового вопроса в приватном списке
- PUT `api/lists/:listid/:questionid/edit` - редактирование вопроса в приватном списке
- DELETE `api/lists/:listid/:questionid` - удаление вопроса из списка
- PUT `api/lists/:listid/order_edit` - перестановка вопросов в спике
### API аутентификации
Аутентификация выполнена на основе OAuth 2.0 при помощи `passport.js` с использованием стратегии `passport-VKontakte`. Пользовательская сессия хранится в браузере с использованием куки и библиотеки `cookie-session`. При выходе из системы куки удаляются.
- GET `auth/vk` - запуск стратегии, получение данных пользователей при помощи API Вконтакте
- GET `auth/vk/redirect` - редирект пользователя после успешной авторизации в системе
- GET `auth/logout` - выход пользователя из системы
## Технологии разработки
### Языки программирования
javascript, typescript
### Библиотеки и фреймворки
- Библиотеки и фреймворки, использованные в разработке api, расположены по адресу: `server->package.json`
- Библиотеки и фреймворки, использованные в разработке ui, расположены по адресу: `ui->package.json`
### СУБД
MySQL, при работе с api использовалась библиотека `mysql2`.
